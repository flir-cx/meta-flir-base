From eacec22b8e85717694457359eefda830c3598ab9 Mon Sep 17 00:00:00 2001
From: David Sernelius <david.sernelius@flir.se>
Date: Fri, 18 Jan 2019 09:51:54 +0100
Subject: [PATCH] Adds Sherlock device tree

Signed-off-by: David Sernelius <david.sernelius@flir.se>
---
 arch/arm/boot/dts/Makefile             |   1 +
 arch/arm/boot/dts/imx7ulp-ec201.dtsi   | 535 +++++++++++++++++++++++++
 arch/arm/boot/dts/imx7ulp-sherlock.dts |  18 +
 3 files changed, 554 insertions(+)
 create mode 100644 arch/arm/boot/dts/imx7ulp-ec201.dtsi
 create mode 100644 arch/arm/boot/dts/imx7ulp-sherlock.dts

diff --git a/arch/arm/boot/dts/Makefile b/arch/arm/boot/dts/Makefile
index dbffd241cc14..8f1916bdda04 100644
--- a/arch/arm/boot/dts/Makefile
+++ b/arch/arm/boot/dts/Makefile
@@ -646,6 +646,7 @@ dtb-$(CONFIG_SOC_IMX7D) += \
 dtb-$(CONFIG_SOC_IMX7ULP) += \
 	imx7ulp-14x14-arm2.dtb \
 	imx7ulp-bblc.dtb \
+	imx7ulp-sherlock.dtb \
 	imx7ulp-evk.dtb \
 	imx7ulp-evkb-spi-slave.dtb \
 	imx7ulp-evkb-emmc.dtb \
diff --git a/arch/arm/boot/dts/imx7ulp-ec201.dtsi b/arch/arm/boot/dts/imx7ulp-ec201.dtsi
new file mode 100644
index 000000000000..7e3ea9958103
--- /dev/null
+++ b/arch/arm/boot/dts/imx7ulp-ec201.dtsi
@@ -0,0 +1,535 @@
+/*
+ * Copyright 2019 FLIR
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+/ {
+	chosen {
+		stdout-path = &lpuart4;
+	};
+
+	memory {
+		device_type = "memory";
+		reg = <0x60000000 0x20000000>;
+	};
+
+	backlight {
+		compatible = "pwm-backlight";
+		pwms = <&pwm0 5 50000>;
+		brightness-levels = <0 10 20 30 40 50 60 70 80 90 100>;
+		default-brightness-level = <7>;
+		status = "okay";
+	};
+
+	regulators {
+		wlan_en_reg: wlan_en_reg {
+			compatible = "regulator-fixed";
+			regulator-name = "wl";
+			regulator-min-microvolt = <1800000>;
+			regulator-max-microvolt = <1800000>;
+			gpio = <&gpio_pte 6 GPIO_ACTIVE_HIGH>;
+			startup-delay-us = <70000>;
+			enable-active-high;
+		};
+
+		bt_en_reg: bt_en_reg {
+			compatible = "regulator-fixed";
+			regulator-name = "bt";
+			regulator-min-microvolt = <1800000>;
+			regulator-max-microvolt = <1800000>;
+			gpio = <&gpio_pte 12 GPIO_ACTIVE_HIGH>;
+			startup-delay-us = <70000>;
+			enable-active-high;
+		};
+	};
+
+//  /* Torch PWM, LPTPM7 (PTC15) */
+//  pwm1: tpm@40280000 {
+//      compatible = "nxp,tpm-pwm";
+//      reg = <0x40280000 0x1000>;
+//      nxp,pwm-number = <6>;
+//      assigned-clocks = <&clks IMX7ULP_CLK_LPTPM7>;
+//      assigned-clock-parents = <&clks IMX7ULP_CLK_SOSC_BUS_CLK>;
+//      clocks = <&clks IMX7ULP_CLK_LPTPM7>;
+//      #pwm-cells = <2>;
+//      pinctrl-names = "default", "sleep";
+//      pinctrl-0 = <&pinctrl_pwm1>;
+//      pinctrl-1 = <&pinctrl_pwm1>;
+//  };
+//
+//  pwm1_torch {
+//      compatible = "pwm-backlight";
+//      pwms = <&pwm1 0 200000>; // 0.2ms
+//      brightness-levels = <0 10 20 30 40 50 60 70 80 90 100>;
+//  };
+
+	gpio_keys {
+		compatible = "gpio-keys";
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_gpiokeys>;
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		TRIG {
+			label = "TRIG";
+			linux,input-type = <5>; /* EV_SW */
+			linux,code = <0x120>;
+			gpios = <&gpio_pte 13 GPIO_ACTIVE_LOW>;
+			debounce-interval = <5>;
+		};
+
+		SW_ON {
+			label = "SW_ON";
+			linux,input-type = <5>; /* EV_SW */
+			linux,code = <0x100>;
+			gpios = <&gpio_pte 14 GPIO_ACTIVE_LOW>;
+			debounce-interval = <5>;
+		};
+	};
+
+	mipi_dsi_reset: mipi-dsi-reset {
+		compatible = "gpio-reset";
+		reset-gpios = <&gpio_ptf 18 GPIO_ACTIVE_LOW>;   // Dummy GPIO, not used
+		reset-delay-us = <1000>;
+		#reset-cells = <0>;
+	};
+
+	emmc_reset: emmc_reset {
+		compatible = "gpio-reset";
+		reset-gpios =  <&gpio_ptd 0 GPIO_ACTIVE_LOW>;
+		reset-delay-us = <1000>;
+		#reset-cells = <0>;
+	};
+
+	v4l2_cap_0 {
+		compatible = "fsl,imx7-rpmsg-capture";
+		status = "okay";
+	};
+};
+
+&cpu0 {
+	arm-supply= <&sw1_reg>;
+};
+
+/* LCD */
+&mipi_dsi {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_mipi_dsi_reset>;
+	pinctrl-1 = <&pinctrl_mipi_dsi_reset>;
+	lcd_panel = "ORISE-VGA";
+	status = "okay";
+	resets = <&mipi_dsi_reset>;
+};
+
+&lcdif {
+	status = "okay";
+	disp-dev = "mipi_dsi_northwest";
+	display = <&display0>;
+
+	display0: display@0 {
+		bits-per-pixel = <32>;
+		bus-width = <24>;
+	};
+};
+
+&iomuxc1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_hog_1>;
+
+	pinctrl_hog_1: hoggrp-1 {
+    	fsl,pins = <
+ 			IMX7ULP_PAD_PTC0__PTC0      0x20002  /* SHUTTER_IN */
+ 			IMX7ULP_PAD_PTC1__PTC1      0x20002  /* SHUTTER_OUT */
+ 			IMX7ULP_PAD_PTE12__PTE12    0x3     /* BT_EN */
+ 			>;
+	};
+
+	pinctrl_pwm0: pwm0grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC6__TPM4_CH5  0x3
+			>;
+	};
+
+	pinctrl_gpiokeys: gpiokeysgrp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTE13__PTE13  0x10003
+			IMX7ULP_PAD_PTE14__PTE14  0x10003
+			>;
+		};
+
+//	pinctrl_pwm1: pwm1_grp {
+//		fsl,pins = <
+//			IMX7ULP_PAD_PTC15__TPM7_CH1  0x3
+//			>;
+//	};
+
+	pinctrl_lpi2c5: lpi2c5grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC4__LPI2C5_SCL    0x27
+			IMX7ULP_PAD_PTC5__LPI2C5_SDA    0x27
+			IMX7ULP_PAD_PTC19__PTC19        0x3  /* PMIC_INT */
+			IMX7ULP_PAD_PTC18__PTC18        0x27 /* PMIC_WD */
+			>;
+	};
+
+	pinctrl_lpi2c6: lpi2c6grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC8__LPI2C6_SCL    0x27
+			IMX7ULP_PAD_PTC9__LPI2C6_SDA    0x27
+			IMX7ULP_PAD_PTC10__PTC10        0x2 /* ACC_INT_n */
+			>;
+	};
+
+	pinctrl_lpi2c7: lpi2c7grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC12__LPI2C7_SCL   0x27
+			IMX7ULP_PAD_PTC13__LPI2C7_SDA   0x27
+			IMX7ULP_PAD_PTC14__PTC14        0x3 /* PCAPINT_n */
+			IMX7ULP_PAD_PTC7__PTC7          0x3 /* TP_RESET_n */
+			>;
+	};
+
+	pinctrl_lpuart4: lpuart4grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC3__LPUART4_RX    0x3
+			IMX7ULP_PAD_PTC2__LPUART4_TX    0x3
+			>;
+	};
+
+	pinctrl_lpuart6: lpuart6grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTE10__LPUART6_TX   0x3
+			IMX7ULP_PAD_PTE11__LPUART6_RX   0x3
+			IMX7ULP_PAD_PTE9__LPUART6_RTS_B 0x3
+			IMX7ULP_PAD_PTE8__LPUART6_CTS_B 0x3
+			>;
+	};
+
+	pinctrl_usdhc1: usdhc1grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTE3__SDHC1_CMD     0x43
+			IMX7ULP_PAD_PTE2__SDHC1_CLK     0x10042
+			IMX7ULP_PAD_PTE1__SDHC1_D0      0x43
+			IMX7ULP_PAD_PTE0__SDHC1_D1      0x43
+			IMX7ULP_PAD_PTE5__SDHC1_D2      0x43
+			IMX7ULP_PAD_PTE4__SDHC1_D3      0x43
+			IMX7ULP_PAD_PTE6__PTE6          0x3     /* WLAN_EN */
+			IMX7ULP_PAD_PTE7__PTE7          0x2     /* WLAN_IRQ */
+			>;
+	};
+
+	pinctrl_usdhc0: usdhc0grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTD0__PTD0      0x20000     /* USDHC0 RST */
+			IMX7ULP_PAD_PTD1__SDHC0_CMD 0x43
+			IMX7ULP_PAD_PTD2__SDHC0_CLK 0x10042
+			IMX7ULP_PAD_PTD3__SDHC0_D7  0x43
+			IMX7ULP_PAD_PTD4__SDHC0_D6  0x43
+			IMX7ULP_PAD_PTD5__SDHC0_D5  0x43
+			IMX7ULP_PAD_PTD6__SDHC0_D4  0x43
+			IMX7ULP_PAD_PTD7__SDHC0_D3  0x43
+			IMX7ULP_PAD_PTD8__SDHC0_D2  0x43
+			IMX7ULP_PAD_PTD9__SDHC0_D1  0x43
+			IMX7ULP_PAD_PTD10__SDHC0_D0 0x43
+			IMX7ULP_PAD_PTD11__SDHC0_DQS    0x42
+			>;
+	};
+
+	pinctrl_usdhc1: usdhc1grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTE3__SDHC1_CMD     0x43
+			IMX7ULP_PAD_PTE2__SDHC1_CLK     0x10042
+			IMX7ULP_PAD_PTE1__SDHC1_D0      0x43
+			IMX7ULP_PAD_PTE0__SDHC1_D1      0x43
+			IMX7ULP_PAD_PTE5__SDHC1_D2      0x43
+			IMX7ULP_PAD_PTE4__SDHC1_D3      0x43
+			>;
+	};
+
+	pinctrl_mipi_dsi_reset: mipi_dsi_reset_grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTF18__PTF18    0x3 /* Dummy */
+			>;
+	};
+
+	pinctrl_camera: camera_grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTF16__PTF16    0x20043  /* CAMERA CLK ENABLE*/
+			IMX7ULP_PAD_PTF15__PTF15    0x20043  /* CAMERA PWDN */
+			IMX7ULP_PAD_PTF14__PTF14    0x20043  /* CAMERA RESET */
+			IMX7ULP_PAD_PTF3__VIU_PCLK  0x10043
+			IMX7ULP_PAD_PTF6__VIU_D2    0x43
+			IMX7ULP_PAD_PTF7__VIU_D3    0x43
+			IMX7ULP_PAD_PTF8__VIU_D4    0x43
+			IMX7ULP_PAD_PTF9__VIU_D5    0x43
+			IMX7ULP_PAD_PTF10__VIU_D6   0x43
+			IMX7ULP_PAD_PTF11__VIU_D7   0x43
+			IMX7ULP_PAD_PTF12__VIU_D8   0x43
+			IMX7ULP_PAD_PTF13__VIU_D9   0x43
+			>;
+	};
+};
+
+/*  PMIC */
+&lpi2c5 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_lpi2c5>;
+	pinctrl-1 = <&pinctrl_lpi2c5>;
+	status = "okay";
+
+	pmic: pf1550@08 {
+		compatible = "fsl,pf1550";
+		interrupt-parent = <&gpio_ptc>;
+		interrupts = <19 IRQ_TYPE_EDGE_FALLING>;
+		reg = <0x08>;
+
+		onkey {
+			compatible = "fsl,pf1550-onkey";
+			linux,keycode = <KEY_POWER>;
+			wakeup;
+		};
+
+		charger {
+			compatible = "fsl,pf1550-charger";
+		};
+
+		regulators {
+			compatible = "fsl,pf1550-regulator";
+
+			sw1_reg: SW1 {
+				regulator-name = "SW1";
+				regulator-min-microvolt = <600000>;
+				regulator-max-microvolt = <1387500>;
+				regulator-boot-on;
+				regulator-always-on;
+				regulator-ramp-delay = <6250>;
+			};
+
+			sw2_reg: SW2 {
+				regulator-name = "SW2";
+				regulator-min-microvolt = <600000>;
+				regulator-max-microvolt = <1387500>;
+				regulator-boot-on;
+				regulator-always-on;
+			};
+
+			sw3_reg: SW3 {
+				regulator-name = "SW3";
+				regulator-min-microvolt = <1800000>;
+				regulator-max-microvolt = <3300000>;
+				regulator-boot-on;
+				regulator-always-on;
+			};
+
+			vref_reg: VREFDDR {
+				regulator-name = "VREFDDR";
+				regulator-min-microvolt = <1200000>;
+				regulator-max-microvolt = <1200000>;
+				regulator-boot-on;
+				regulator-always-on;
+			};
+
+			vldo1_reg: LDO1 {
+				regulator-name = "LDO1";
+				regulator-min-microvolt = <750000>;
+				regulator-max-microvolt = <3300000>;
+				regulator-always-on;
+			};
+
+			vldo2_reg: LDO2 {
+				regulator-name = "LDO2";
+				regulator-min-microvolt = <1800000>;
+				regulator-max-microvolt = <3300000>;
+				regulator-always-on;
+			};
+
+			vldo3_reg: LDO3 {
+				regulator-name = "LDO3";
+				regulator-min-microvolt = <750000>;
+				regulator-max-microvolt = <3300000>;
+				regulator-always-on;
+			};
+		};
+	};
+};
+
+/*  IO expander for VCAM, Lepton, Accelerometer, Temp sensor 1 and 2, EEPROM */
+&lpi2c6 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_lpi2c6>;
+	pinctrl-1 = <&pinctrl_lpi2c6>;
+	status = "okay";
+
+	ov5640: ov5640@3c {
+		compatible = "ovti,ov5640";
+		reg = <0x3c>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_camera>;
+		clocks = <&clks IMX7ULP_CLK_DUMMY>;
+		clock-names = "csi_mclk";
+		pwn-gpios = <&gpio_ptf 15 GPIO_ACTIVE_HIGH>;
+		rst-gpios = <&gpio_ptf 14 GPIO_ACTIVE_HIGH>;
+		clk-gpios = <&gpio_ptf 16 GPIO_ACTIVE_HIGH>;
+		csi_id = <0>;
+		mclk = <24000000>;
+		mclk_source = <0>;
+		status = "okay";
+
+		port {
+			ov5640_ep: endpoint {
+				remote-endpoint = <&viu_ep>;
+			};
+		};
+	};
+
+	acc_mma8452: acc_mma8452@1D {
+		compatible = "fsl,mma8452";
+		reg = <0x1D>;
+		interrupt-parent = <&gpio_ptc>;
+		interrupts = <10 IRQ_TYPE_LEVEL_HIGH>;
+	 };
+
+	tmp116_1: tmp116_1@48 {
+		compatible = "ti,tmp116";
+		reg = <0x48>;
+	};
+
+	tmp116_2: tmp116_2@49 {
+		compatible = "ti,tmp116";
+		reg = <0x49>;
+	};
+
+	eeprom_24c02: eeprom_24c02@57 {
+		compatible = "atmel,24c02";
+		reg = <0x57>;
+		pagesize = <16>;
+	};
+};
+
+/* Touch screen */
+&lpi2c7 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	pinctrl-names = "default",  "sleep";
+	pinctrl-0 = <&pinctrl_lpi2c7>;
+	pinctrl-1 = <&pinctrl_lpi2c7>;
+	status = "okay";
+
+	touchscreen:edt_ft5336@38 {
+		compatible = "edt,edt-ft5306";
+		reg = <0x38>;
+		interrupt-parent = <&gpio_ptc>;
+		interrupts = <14 GPIO_ACTIVE_HIGH>;
+		touchscreen-size-x = <640>;
+		touchscreen-size-y = <480>;
+		reset-gpios = <&gpio_ptc 7 GPIO_ACTIVE_LOW>;
+		status = "okay";
+	};
+};
+
+&lpuart4 { /* console */
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_lpuart4>;
+	pinctrl-1 = <&pinctrl_lpuart4>;
+	status = "okay";
+};
+
+&lpuart6 { /* BT */
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_lpuart6>;
+	pinctrl-1 = <&pinctrl_lpuart6>;
+	/* Default 48 MHz FIRC clk does not run at 48 MHz, use 24 MHz SOSC */
+	assigned-clock-parents = <&clks IMX7ULP_CLK_SOSC_BUS_CLK>;
+	assigned-clock-rates = <24000000>;
+	status = "okay";
+};
+
+&pwm0 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_pwm0>;
+	pinctrl-1 = <&pinctrl_pwm0>;
+	status = "okay";
+};
+
+&rpmsg_reserved{
+	reg = <0x7FF80000 0x80000>;
+};
+
+&rpmsg{
+	/*
+	 * 64K for one rpmsg instance, default using 2 rpmsg instances:
+	 * --0x7FF80000~0x7FF8FFFF: pmic,pm,audio,keys,gpio,sensor
+	 * --0x7FF90000~0x7FF9FFFF: pingpong,virtual tty
+	 */
+	vdev-nums = <2>;
+	reg = <0x7FF80000 0x20000>;
+	status = "okay";
+};
+
+&heartbeat_rpmsg{
+	status = "disabled";
+};
+
+&rtc_rpmsg{
+	status = "disabled";
+};
+
+&usbotg1 {
+	dr_mode = "peripheral";
+	srp-disable;
+	hnp-disable;
+	adp-disable;
+	status = "okay";
+};
+
+/* emmc */
+&usdhc0 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_usdhc0>;
+	pinctrl-1 = <&pinctrl_usdhc0>;
+	resets = <&emmc_reset>;
+	bus-width = <8>;
+	non-removable;
+	status = "okay";
+};
+
+/* wifi */
+&usdhc1 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_usdhc1>;
+	pinctrl-1 = <&pinctrl_usdhc1>;
+	bus-width = <4>;
+	pm-ignore-notify;
+	keep-power-in-suspend;
+	non-removable;
+	wifi-host;
+	status = "okay";
+
+	vmmc-supply = <&wlan_en_reg>;
+	#address-cells = <1>;
+	#size-cells = <0>;
+	max-frequency = <25000000>;
+	wlcore: wlcore@2 {
+		compatible = "ti,wl1837";
+		reg = <2>;
+		interrupt-parent = <&gpio_pte>;
+		interrupts = <7 IRQ_TYPE_LEVEL_HIGH>;
+		platform-quirks = <1>;
+	};
+};
+
+&viu {
+	status = "okay";
+	port {
+	viu_ep: endpoint {
+			remote-endpoint = <&ov5640_ep>;
+		};
+	};
+};
diff --git a/arch/arm/boot/dts/imx7ulp-sherlock.dts b/arch/arm/boot/dts/imx7ulp-sherlock.dts
new file mode 100644
index 000000000000..906d679e84b2
--- /dev/null
+++ b/arch/arm/boot/dts/imx7ulp-sherlock.dts
@@ -0,0 +1,18 @@
+/*
+ * Copyright 2019 FLIR
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+/dts-v1/;
+
+#include <dt-bindings/input/input.h>
+#include "imx7ulp.dtsi"
+#include "imx7ulp-ec201.dtsi"
+
+/ {
+	model = "FLIR i.MX7ULP Sherlock board";
+	compatible = "flir,imx7ulp-sherlock", "flir,imx7ulp-ec201", "fsl,imx7ulp", "Generic DT based system";
+};
-- 
2.17.1

