From 481731effe6c78ed22767e83724a6c898e0bb7c0 Mon Sep 17 00:00:00 2001
From: David Sernelius <david.sernelius@flir.se>
Date: Fri, 18 Jan 2019 09:51:05 +0100
Subject: [PATCH] Modify and clean up imx7ulp-bblc.dts

Signed-off-by: David Sernelius <david.sernelius@flir.se>
---
 arch/arm/boot/dts/imx7ulp-bblc.dts | 460 ++++++++++++++---------------
 1 file changed, 226 insertions(+), 234 deletions(-)

diff --git a/arch/arm/boot/dts/imx7ulp-bblc.dts b/arch/arm/boot/dts/imx7ulp-bblc.dts
index 3e59753ca655..9512a6efd96e 100644
--- a/arch/arm/boot/dts/imx7ulp-bblc.dts
+++ b/arch/arm/boot/dts/imx7ulp-bblc.dts
@@ -12,16 +12,16 @@
 #include <dt-bindings/input/input.h>
 
 /* BBLC GPIO expansion port usage
- * 
- * GPIO		Schema		Conn. pin	Usage
- * PTC 12	GPIO_A7_0 	9
- * PTC 13	GPIO_A7_1 	10		USB OTG id (dummy)
- * PTC 14	GPIO_A7_2 	11		WL_REG_ON (Laird)
- * PTC 15	GPIO_A7_3 	12		BT_REG_ON (Laird)
- * PTC 16	GPIO_A7_4 	13
- * PTC 17	GPIO_A7_5 	14
- * PTC 18	GPIO_A7_6 	15		MIPI dummy
- * PTC 19	GPIO_A7_7 	16		PMIC IRQ
+ *
+ * GPIO			Schema			Conn. pin		Usage
+ * PTC 12		GPIO_A7_0		9
+ * PTC 13		GPIO_A7_1		10				USB OTG id (dummy)
+ * PTC 14		GPIO_A7_2		11				WL_REG_ON (Laird)
+ * PTC 15		GPIO_A7_3		12				BT_REG_ON (Laird)
+ * PTC 16		GPIO_A7_4		13
+ * PTC 17		GPIO_A7_5		14
+ * PTC 18		GPIO_A7_6		15				MIPI dummy
+ * PTC 19		GPIO_A7_7		16				PMIC IRQ
  */
 
 / {
@@ -37,6 +37,20 @@
 		reg = <0x60000000 0x20000000>;
 	};
 
+	// We use another PWM than evalkit - TPM5 channel 1
+	pwm1: tpm@40260000 {
+		compatible = "nxp,tpm-pwm";
+		reg = <0x40260000 0x1000>;
+		nxp,pwm-number = <2>;
+		assigned-clocks = <&clks IMX7ULP_CLK_LPTPM5>;
+		assigned-clock-parents = <&clks IMX7ULP_CLK_SOSC_BUS_CLK>;
+		clocks = <&clks IMX7ULP_CLK_LPTPM5>;
+		#pwm-cells = <2>;
+		pinctrl-names = "default", "sleep";
+		pinctrl-0 = <&pinctrl_pwm1>;
+		pinctrl-1 = <&pinctrl_pwm1>;
+	};
+
 	backlight {
 		compatible = "pwm-backlight";
 		pwms = <&pwm1 1 50000>;
@@ -45,34 +59,11 @@
 		status = "okay";
 	};
 
-	mipi_dsi_reset: mipi-dsi-reset {
-		compatible = "gpio-reset";
-		reset-gpios = <&gpio_ptc 18 GPIO_ACTIVE_LOW>;	// Dummy GPIO, not used
-		reset-delay-us = <1000>;
-		#reset-cells = <0>;
-	};
-
-	emmc_reset: emmc_reset {
-		compatible = "gpio-reset";
-		reset-gpios =  <&gpio_ptd 0 GPIO_ACTIVE_LOW>;
-		reset-delay-us = <1000>;
-		#reset-cells = <0>;
-	};
-			
 	regulators {
 		compatible = "simple-bus";
 		#address-cells = <1>;
 		#size-cells = <0>;
-		
-		dummy_reg: dummy_reg {
-			compatible = "regulator-fixed";
-			regulator-name = "dummy_reg";
-			regulator-min-microvolt = <600000>;
-			regulator-max-microvolt = <1387500>;
-			regulator-boot-on;
-			regulator-always-on;
-		};
-	
+
 		reg_wl: regulator-wl {
 			compatible = "regulator-fixed";
 			regulator-name = "wl";
@@ -83,7 +74,7 @@
 			regulator-max-microvolt = <3300000>;
 			regulator-always-on;
 		};
-	
+
 		reg_bt: regulator-bt {
 			compatible = "regulator-fixed";
 			regulator-name = "bt";
@@ -95,33 +86,29 @@
 			regulator-always-on;
 		};
 	};
-	
-	extcon_usb1: extcon_usb1 {
-		compatible = "linux,extcon-usb-gpio";
-		id-gpio = <&gpio_ptc 13 GPIO_ACTIVE_HIGH>;
-		pinctrl-names = "default", "sleep";
-		pinctrl-0 = <&pinctrl_extcon_usb1>;
-		pinctrl-1 = <&pinctrl_extcon_usb1>;
+
+	mipi_dsi_reset: mipi-dsi-reset {
+		compatible = "gpio-reset";
+		reset-gpios = <&gpio_ptf 18 GPIO_ACTIVE_LOW>;   // Dummy GPIO, not used
+		reset-delay-us = <1000>;
+		#reset-cells = <0>;
+	};
+
+	emmc_reset: emmc_reset {
+		compatible = "gpio-reset";
+		reset-gpios =  <&gpio_ptd 0 GPIO_ACTIVE_LOW>;
+		reset-delay-us = <1000>;
+		#reset-cells = <0>;
 	};
 
 	v4l2_cap_0 {
 		compatible = "fsl,imx7-rpmsg-capture";
 		status = "okay";
 	};
-	
-	// We use another PWM than evalkit - TPM5 channel 1
-	pwm1: tpm@40260000 {
-		compatible = "nxp,tpm-pwm";
-		reg = <0x40260000 0x1000>;
-		nxp,pwm-number = <2>;
-		assigned-clocks = <&clks IMX7ULP_CLK_LPTPM5>;
-		assigned-clock-parents = <&clks IMX7ULP_CLK_SOSC_BUS_CLK>;
-		clocks = <&clks IMX7ULP_CLK_LPTPM5>;
-		#pwm-cells = <2>;
-		pinctrl-names = "default", "sleep";
-		pinctrl-0 = <&pinctrl_pwm1>;
-		pinctrl-1 = <&pinctrl_pwm1>;
-	};
+};
+
+&cpu0 {
+	arm-supply= <&sw1_reg>;
 };
 
 &ahbbridge1 {
@@ -131,14 +118,10 @@
 		reg = <0x40A10000 0x1000>;
 		interrupts = <GIC_SPI 23 IRQ_TYPE_LEVEL_HIGH>;
 		clocks = <&clks IMX7ULP_CLK_LPTPM6>,
-			 <&clks IMX7ULP_CLK_NIC1_BUS_DIV>;
+				 <&clks IMX7ULP_CLK_NIC1_BUS_DIV>;
 		clock-names = "per", "ipg";
 	};
 };
-	
-&cpu0 {
-	arm-supply= <&sw1_reg>;
-};
 
 // Disable TPM5 as it is used by PWM - we use TPM6 instead
 &tpm5 {
@@ -155,124 +138,6 @@
 	status = "disabled";
 };
 
-&iomuxc1 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_hog_1>;
-
-	imx7ulp-evk {
-		pinctrl_hog_1: hoggrp-1 {
-			fsl,pins = <
-				IMX7ULP_PAD_PTC1__PTC1	0x3	 //SHUTTER_OUT
-				IMX7ULP_PAD_PTC14__PTC14	0x3	// WL_EN
-				IMX7ULP_PAD_PTC15__PTC15	0x3	// BT_EN
-			>;
-		};
-
-		pinctrl_pwm1: pwm1_grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTC7__TPM5_CH1	0x3
-			>;
-		};
-
-		pinctrl_lpi2c5: lpi2c5grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTC4__LPI2C5_SCL       0x27
-				IMX7ULP_PAD_PTC5__LPI2C5_SDA       0x27
-				IMX7ULP_PAD_PTC19__PTC19           0x3	// PMIC_INT
-			>;
-		};
-		
-		pinctrl_lpi2c6: lpi2c6grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTE8__LPI2C6_SCL	0x27
-				IMX7ULP_PAD_PTE9__LPI2C6_SDA	0x27
-			>;
-		};
-		
-		pinctrl_lpi2c7: lpi2c7grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTE12__LPI2C7_SCL	0x27
-				IMX7ULP_PAD_PTE13__LPI2C7_SDA	0x27
-				IMX7ULP_PAD_PTE14__PTE14	0x3
-				IMX7ULP_PAD_PTC6__PTC6		0x3
-			>;
-		};
-		
-		pinctrl_lpuart4: lpuart4grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTC3__LPUART4_RX	0x3
-				IMX7ULP_PAD_PTC2__LPUART4_TX	0x3
-			>;
-		};
-
-		pinctrl_lpuart6: lpuart6grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTC10__LPUART6_TX	0x3
-				IMX7ULP_PAD_PTC11__LPUART6_RX	0x3
-				IMX7ULP_PAD_PTC9__LPUART6_RTS_B	0x3
-				IMX7ULP_PAD_PTC8__LPUART6_CTS_B	0x3
-			>;
-		};
-
-		pinctrl_usdhc0: usdhc0grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTD0__PTD0		0x20000		/* USDHC0 RST */
-				IMX7ULP_PAD_PTD1__SDHC0_CMD	0x43
-				IMX7ULP_PAD_PTD2__SDHC0_CLK	0x10042
-				IMX7ULP_PAD_PTD3__SDHC0_D7	0x43
-				IMX7ULP_PAD_PTD4__SDHC0_D6	0x43
-				IMX7ULP_PAD_PTD5__SDHC0_D5	0x43
-				IMX7ULP_PAD_PTD6__SDHC0_D4	0x43
-				IMX7ULP_PAD_PTD7__SDHC0_D3	0x43
-				IMX7ULP_PAD_PTD8__SDHC0_D2	0x43
-				IMX7ULP_PAD_PTD9__SDHC0_D1	0x43
-				IMX7ULP_PAD_PTD10__SDHC0_D0	0x43
-				IMX7ULP_PAD_PTD11__SDHC0_DQS	0x42
-			>;
-		};
-
-		pinctrl_usdhc1: usdhc1grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTE3__SDHC1_CMD		0x43
-				IMX7ULP_PAD_PTE2__SDHC1_CLK		0x10042
-				IMX7ULP_PAD_PTE1__SDHC1_D0		0x43
-				IMX7ULP_PAD_PTE0__SDHC1_D1		0x43
-				IMX7ULP_PAD_PTE5__SDHC1_D2		0x43
-				IMX7ULP_PAD_PTE4__SDHC1_D3		0x43
-			>;
-		};
-		
-		pinctrl_extcon_usb1: extcon1grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTC13__PTC13	0x10003
-			>;
-		};
-
-		pinctrl_mipi_dsi_reset: mipi_dsi_reset_grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTC18__PTC18	0x3	// Dummy
-			>;
-		};
-		
-		pinctrl_camera: camera_grp {
-			fsl,pins = <
-				IMX7ULP_PAD_PTF16__PTF16	0x20043  /* CAMERA CLK ENABLE*/
-				IMX7ULP_PAD_PTF15__PTF15	0x20043  /* CAMERA PWDN */
-				IMX7ULP_PAD_PTF14__PTF14	0x20043  /* CAMERA RESET */
-				IMX7ULP_PAD_PTF3__VIU_PCLK	0x10043
-				IMX7ULP_PAD_PTF6__VIU_D2	0x43
-				IMX7ULP_PAD_PTF7__VIU_D3	0x43
-				IMX7ULP_PAD_PTF8__VIU_D4	0x43
-				IMX7ULP_PAD_PTF9__VIU_D5	0x43
-				IMX7ULP_PAD_PTF10__VIU_D6	0x43
-				IMX7ULP_PAD_PTF11__VIU_D7	0x43
-				IMX7ULP_PAD_PTF12__VIU_D8	0x43
-				IMX7ULP_PAD_PTF13__VIU_D9	0x43
-			>;
-		};
-	};
-};
-
 /* LCD */
 &mipi_dsi {
 	pinctrl-names = "default", "sleep";
@@ -294,59 +159,117 @@
 	};
 };
 
-/* Touch screen */
-&lpi2c7 {
-	#address-cells = <1>;
-	#size-cells = <0>;
-	pinctrl-names = "default",  "sleep";
-	pinctrl-0 = <&pinctrl_lpi2c7>;
-	pinctrl-1 = <&pinctrl_lpi2c7>;
-	status = "okay";
-	
-	touchscreen:edt_ft5336@38 {
-		compatible = "edt,edt-ft5306";
-		reg = <0x38>;
-		interrupt-parent = <&gpio_pte>;
-		interrupts = <14 GPIO_ACTIVE_HIGH>;
-		touchscreen-size-x = <640>;
-		touchscreen-size-y = <480>;
-		reset-gpios = <&gpio_ptc 6 GPIO_ACTIVE_LOW>;
-		status = "okay";
+&iomuxc1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_hog_1>;
+
+	pinctrl_hog_1: hoggrp-1 {
+	   fsl,pins = <
+		   IMX7ULP_PAD_PTC0__PTC0          0x20002 // SHUTTER_IN
+		   IMX7ULP_PAD_PTC1__PTC1          0x20002 // SHUTTER_OUT
+		   IMX7ULP_PAD_PTC14__PTC14        0x3     // WL_EN
+		   IMX7ULP_PAD_PTC15__PTC15        0x3     // BT_EN
+		   >;
 	};
-};
-	
-/*  IO expander for keyboard, VCAM, Lepton, Temp sensor 1 and 2, EEPROM	*/
-&lpi2c6 {
-	#address-cells = <1>;
-	#size-cells = <0>;
-	pinctrl-names = "default", "sleep";
-	pinctrl-0 = <&pinctrl_lpi2c6>;
-	pinctrl-1 = <&pinctrl_lpi2c6>;
-	status = "okay";
 
-	ov5640: ov5640@3c {
-		compatible = "ov5640";
-		reg = <0x3c>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_camera>;
-		clocks = <&clks IMX7ULP_CLK_DUMMY>;
-		clock-names = "csi_mclk";
-		pwn-gpios = <&gpio_ptf 15 GPIO_ACTIVE_HIGH>;
-		rst-gpios = <&gpio_ptf 14 GPIO_ACTIVE_HIGH>;
-		clk-gpios = <&gpio_ptf 16 GPIO_ACTIVE_HIGH>;
-		csi_id = <0>;
-		mclk = <24000000>;
-		mclk_source = <0>;
-		status = "okay";
+	pinctrl_usdhc0: usdhc0grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTD0__PTD0      0x20000     /* USDHC0 RST */
+			IMX7ULP_PAD_PTD1__SDHC0_CMD 0x43
+			IMX7ULP_PAD_PTD2__SDHC0_CLK 0x10042
+			IMX7ULP_PAD_PTD3__SDHC0_D7  0x43
+			IMX7ULP_PAD_PTD4__SDHC0_D6  0x43
+			IMX7ULP_PAD_PTD5__SDHC0_D5  0x43
+			IMX7ULP_PAD_PTD6__SDHC0_D4  0x43
+			IMX7ULP_PAD_PTD7__SDHC0_D3  0x43
+			IMX7ULP_PAD_PTD8__SDHC0_D2  0x43
+			IMX7ULP_PAD_PTD9__SDHC0_D1  0x43
+			IMX7ULP_PAD_PTD10__SDHC0_D0 0x43
+			IMX7ULP_PAD_PTD11__SDHC0_DQS    0x42
+			>;
+	};
 
-		port {
-			ov5640_ep: endpoint {
-				remote-endpoint = <&viu_ep>;
-			};
-		};
+	pinctrl_usdhc1: usdhc1grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTE3__SDHC1_CMD     0x43
+			IMX7ULP_PAD_PTE2__SDHC1_CLK     0x10042
+			IMX7ULP_PAD_PTE1__SDHC1_D0      0x43
+			IMX7ULP_PAD_PTE0__SDHC1_D1      0x43
+			IMX7ULP_PAD_PTE5__SDHC1_D2      0x43
+			IMX7ULP_PAD_PTE4__SDHC1_D3      0x43
+			>;
+	};
+
+	pinctrl_mipi_dsi_reset: mipi_dsi_reset_grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTF18__PTF18    0x3 /* Dummy */
+			>;
+	};
+
+	pinctrl_camera: camera_grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTF16__PTF16    0x20043  /* CAMERA CLK ENABLE*/
+			IMX7ULP_PAD_PTF15__PTF15    0x20043  /* CAMERA PWDN */
+			IMX7ULP_PAD_PTF14__PTF14    0x20043  /* CAMERA RESET */
+			IMX7ULP_PAD_PTF3__VIU_PCLK  0x10043
+			IMX7ULP_PAD_PTF6__VIU_D2    0x43
+			IMX7ULP_PAD_PTF7__VIU_D3    0x43
+			IMX7ULP_PAD_PTF8__VIU_D4    0x43
+			IMX7ULP_PAD_PTF9__VIU_D5    0x43
+			IMX7ULP_PAD_PTF10__VIU_D6   0x43
+			IMX7ULP_PAD_PTF11__VIU_D7   0x43
+			IMX7ULP_PAD_PTF12__VIU_D8   0x43
+			IMX7ULP_PAD_PTF13__VIU_D9   0x43
+			>;
+	};
+
+	pinctrl_pwm1: pwm1_grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC7__TPM5_CH1  0x3
+			>;
+	};
+
+	pinctrl_lpi2c5: lpi2c5grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC4__LPI2C5_SCL       0x27
+			IMX7ULP_PAD_PTC5__LPI2C5_SDA       0x27
+			IMX7ULP_PAD_PTC19__PTC19           0x3  // PMIC_INT
+		>;
+	};
+
+	pinctrl_lpi2c6: lpi2c6grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTE8__LPI2C6_SCL    0x27
+			IMX7ULP_PAD_PTE9__LPI2C6_SDA    0x27
+			>;
+	};
+
+	pinctrl_lpi2c7: lpi2c7grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTE12__LPI2C7_SCL   0x27
+			IMX7ULP_PAD_PTE13__LPI2C7_SDA   0x27
+			IMX7ULP_PAD_PTE14__PTE14    0x3
+			IMX7ULP_PAD_PTC6__PTC6      0x3
+			>;
+	};
+
+	pinctrl_lpuart4: lpuart4grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC3__LPUART4_RX    0x3
+			IMX7ULP_PAD_PTC2__LPUART4_TX    0x3
+		>;
+	};
+
+	pinctrl_lpuart6: lpuart6grp {
+		fsl,pins = <
+			IMX7ULP_PAD_PTC10__LPUART6_TX   0x3
+			IMX7ULP_PAD_PTC11__LPUART6_RX   0x3
+			IMX7ULP_PAD_PTC9__LPUART6_RTS_B 0x3
+			IMX7ULP_PAD_PTC8__LPUART6_CTS_B 0x3
+		>;
 	};
 };
-	
+
 /*  PMIC */
 &lpi2c5 {
 	#address-cells = <1>;
@@ -432,6 +355,75 @@
 	};
 };
 
+/*  IO expander for VCAM, Lepton, Temp sensor 1 and 2, EEPROM */
+&lpi2c6 {
+#address-cells = <1>;
+#size-cells = <0>;
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_lpi2c6>;
+	pinctrl-1 = <&pinctrl_lpi2c6>;
+	status = "okay";
+
+	ov5640: ov5640@21 {
+		compatible = "ovti,ov5640";
+		reg = <0x21>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_camera>;
+		clocks = <&clks IMX7ULP_CLK_DUMMY>;
+		clock-names = "csi_mclk";
+		pwn-gpios = <&gpio_ptf 15 GPIO_ACTIVE_HIGH>;
+		rst-gpios = <&gpio_ptf 14 GPIO_ACTIVE_HIGH>;
+		clk-gpios = <&gpio_ptf 16 GPIO_ACTIVE_HIGH>;
+		csi_id = <0>;
+		mclk = <24000000>;
+		mclk_source = <0>;
+		status = "okay";
+
+		port {
+			ov5640_ep: endpoint {
+				remote-endpoint = <&viu_ep>;
+			};
+		};
+	};
+
+	tmp116_1: tmp116_1@48 {
+		compatible = "ti,tmp116";
+		reg = <0x48>;
+	};
+
+	tmp116_2: tmp116_2@49 {
+		compatible = "ti,tmp116";
+		reg = <0x49>;
+	};
+
+	eeprom_24c02: eeprom_24c02@57 {
+		compatible = "atmel,24c02";
+		reg = <0x57>;
+		pagesize = <16>;
+	};
+};
+
+/* Touch screen */
+&lpi2c7 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	pinctrl-names = "default",  "sleep";
+	pinctrl-0 = <&pinctrl_lpi2c7>;
+	pinctrl-1 = <&pinctrl_lpi2c7>;
+	status = "okay";
+
+	touchscreen:edt_ft5336@38 {
+		compatible = "edt,edt-ft5306";
+		reg = <0x38>;
+		interrupt-parent = <&gpio_pte>;
+		interrupts = <14 GPIO_ACTIVE_HIGH>;
+		reset-gpios = <&gpio_ptc 6 GPIO_ACTIVE_LOW>;
+		touchscreen-size-x = <640>;
+		touchscreen-size-y = <480>;
+		status = "okay";
+	};
+};
+
 &lpuart4 { /* console */
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpuart4>;
@@ -473,7 +465,7 @@
 };
 
 &usbotg1 {
-	extcon = <0>, <&extcon_usb1>;
+	dr_mode = "peripheral";
 	srp-disable;
 	hnp-disable;
 	adp-disable;
@@ -485,11 +477,8 @@
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_usdhc0>;
 	pinctrl-1 = <&pinctrl_usdhc0>;
-	bus-width = <8>;
-	no-1-8-v;
 	resets = <&emmc_reset>;
-	pm-ignore-notify;
-	keep-power-in-suspend;
+	bus-width = <8>;
 	non-removable;
 	status = "okay";
 };
@@ -499,18 +488,21 @@
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_usdhc1>;
 	pinctrl-1 = <&pinctrl_usdhc1>;
+	bus-width = <4>;
 	no-1-8-v;
+	pm-ignore-notify;
+	keep-power-in-suspend;
 	non-removable;
-	status = "okay";
 	wifi-host;
+	status = "okay";
 };
 
 &viu {
 	status = "okay";
-
 	port {
 		viu_ep: endpoint {
 			remote-endpoint = <&ov5640_ep>;
 		};
 	};
 };
+
-- 
2.17.1

