From 2df5cefc54a49c5c7f3c81cc39e3620210c58b57 Mon Sep 17 00:00:00 2001
From: Peter Fitger <peter.fitger@flir.se>
Date: Wed, 12 Sep 2018 11:06:44 +0200
Subject: [PATCH] Support for Evander LCD on BBLC

Signed-off-by: David Sernelius <david.sernelius@flir.se>
---
 arch/arm/boot/dts/imx7ulp-bblc.dts           | 102 ++++++--
 drivers/video/fbdev/mxc/Kconfig              |   5 +
 drivers/video/fbdev/mxc/Makefile             |   1 +
 drivers/video/fbdev/mxc/mipi_dsi.h           |   5 +
 drivers/video/fbdev/mxc/mipi_dsi_northwest.c |   5 +
 drivers/video/fbdev/mxc/mxcfb_otm1287a.c     | 236 +++++++++++++++++++
 6 files changed, 331 insertions(+), 23 deletions(-)
 create mode 100644 drivers/video/fbdev/mxc/mxcfb_otm1287a.c

diff --git a/arch/arm/boot/dts/imx7ulp-bblc.dts b/arch/arm/boot/dts/imx7ulp-bblc.dts
index 883741845922..36182f6f9f6a 100644
--- a/arch/arm/boot/dts/imx7ulp-bblc.dts
+++ b/arch/arm/boot/dts/imx7ulp-bblc.dts
@@ -31,12 +31,18 @@
 
 	backlight {
 		compatible = "pwm-backlight";
-		pwms = <&pwm0 1 50000>; //TODO: pwm timings
-		brightness-levels = <0 20 25 30 35 40 100>;
-		default-brightness-level = <6>;
+		pwms = <&pwm1 1 50000>;
+		brightness-levels = <0 10 20 30 40 50 60 70 80 90 100>;
+		default-brightness-level = <7>;
 		status = "okay";
 	};
 
+	mipi_dsi_reset: mipi-dsi-reset {
+		compatible = "gpio-reset";
+		reset-gpios = <&gpio_ptc 19 GPIO_ACTIVE_LOW>;	// Dummy GPIO, not used
+		reset-delay-us = <1000>;
+		#reset-cells = <0>;
+	};
 
 	emmc_reset: emmc_reset {
 		compatible = "gpio-reset";
@@ -58,15 +64,16 @@
 			regulator-boot-on;
 			regulator-always-on;
 		};
-		
+	
+	};
+	
+	extcon_usb1: extcon_usb1 {
+		compatible = "linux,extcon-usb-gpio";
+		id-gpio = <&gpio_ptc 13 GPIO_ACTIVE_HIGH>;
+		pinctrl-names = "default", "sleep";
+		pinctrl-0 = <&pinctrl_extcon_usb1>;
+		pinctrl-1 = <&pinctrl_extcon_usb1>;
 	};
-extcon_usb1: extcon_usb1 {
-	compatible = "linux,extcon-usb-gpio";
-	id-gpio = <&gpio_ptc 13 GPIO_ACTIVE_HIGH>;
-	pinctrl-names = "default", "sleep";
-	pinctrl-0 = <&pinctrl_extcon_usb1>;
-	pinctrl-1 = <&pinctrl_extcon_usb1>;
-};
 
 	rpmsg_gpio0: rpmsg-gpio0 {
 		compatible = "fsl,imx-rpmsg-gpio";
@@ -94,13 +101,45 @@ extcon_usb1: extcon_usb1 {
 		compatible = "fsl,imx7-rpmsg-capture";
  		status = "disabled";
 	};
+	
+	// We use another PWM than evalkit - TPM5 channel 1
+	pwm1: tpm@40260000 {
+		compatible = "nxp,tpm-pwm";
+		reg = <0x40260000 0x1000>;
+		nxp,pwm-number = <2>;
+		assigned-clocks = <&clks IMX7ULP_CLK_LPTPM5>;
+		assigned-clock-parents = <&clks IMX7ULP_CLK_SOSC_BUS_CLK>;
+		clocks = <&clks IMX7ULP_CLK_LPTPM5>;
+		#pwm-cells = <2>;
+		pinctrl-names = "default", "sleep";
+		pinctrl-0 = <&pinctrl_pwm1>;
+		pinctrl-1 = <&pinctrl_pwm1>;
+	};
+	
+	// Set up new system timer as TPM5 is used by PWM
+	tpm6: tpm@40A10000 {
+		compatible = "fsl,imx7ulp-tpm";
+		reg = <0x40A10000 0x1000>;
+		interrupts = <GIC_SPI 23 IRQ_TYPE_LEVEL_HIGH>;
+		clocks = <&clks IMX7ULP_CLK_LPTPM6>,
+			 <&clks IMX7ULP_CLK_NIC1_BUS_DIV>;
+		clock-names = "per", "ipg";
+	};
 };
 	
 &cpu0 {
 	arm-supply= <&dummy_reg>;
 };
 
+// Disable TPM5 as it is used by PWM - we use TPM6 instead
+&tpm5 {
+	status = "disabled";
+};
 
+// Change system clock from TPM5 to TPM6
+&clks {
+	assigned-clocks = <&clks IMX7ULP_CLK_LPTPM6>;
+};
 
 &iomuxc1 {
 	pinctrl-names = "default";
@@ -109,11 +148,11 @@ extcon_usb1: extcon_usb1 {
 	imx7ulp-evk {
 		pinctrl_hog_1: hoggrp-1 {
 			fsl,pins = <
-				IMX7ULP_PAD_PTC1__PTC1		 //SHUTTER_OUT
+				IMX7ULP_PAD_PTC1__PTC1	0x3	 //SHUTTER_OUT
 			>;
 		};
 
-		pinctrl_pwm0: pwm0_grp {
+		pinctrl_pwm1: pwm1_grp {
 			fsl,pins = <
 				IMX7ULP_PAD_PTC7__TPM5_CH1	0x3
 			>;
@@ -189,7 +228,34 @@ extcon_usb1: extcon_usb1 {
 				IMX7ULP_PAD_PTC13__PTC13	0x10003
 			>;
 		};
+		
+		pinctrl_mipi_dsi_reset: mipi_dsi_reset_grp {
+			fsl,pins = <
+				IMX7ULP_PAD_PTC19__PTC19	0x3	// Dummy
+			>;
+		};
+
+	};
+};
+
+/* LCD */
+&mipi_dsi {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_mipi_dsi_reset>;
+	pinctrl-1 = <&pinctrl_mipi_dsi_reset>;
+	lcd_panel = "ORISE-VGA";
+	status = "okay";
+	resets = <&mipi_dsi_reset>;
+};
 
+&lcdif {
+	status = "okay";
+	disp-dev = "mipi_dsi_northwest";
+	display = <&display0>;
+
+	display0: display@0 {
+		bits-per-pixel = <32>;
+		bus-width = <24>;
 	};
 };
 
@@ -225,8 +291,6 @@ extcon_usb1: extcon_usb1 {
 	status = "okay";
 };
 
-
-
 &lpuart4 { /* console */
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpuart4>;
@@ -241,14 +305,6 @@ extcon_usb1: extcon_usb1 {
 	status = "okay";
 };
 
-
-&pwm0 {
-	pinctrl-names = "default", "sleep";
-	pinctrl-0 = <&pinctrl_pwm0>;
-	pinctrl-1 = <&pinctrl_pwm0>;
-	status = "okay";
-};
-
 &rpmsg{
 	/*
 	 * 64K for one rpmsg instance, default using 2 rpmsg instances:
diff --git a/drivers/video/fbdev/mxc/Kconfig b/drivers/video/fbdev/mxc/Kconfig
index fe2a566fc280..7382af18468e 100644
--- a/drivers/video/fbdev/mxc/Kconfig
+++ b/drivers/video/fbdev/mxc/Kconfig
@@ -76,6 +76,11 @@ config FB_MXC_RK_PANEL_RK055IQH042
 	depends on FB_MXC_DISP_FRAMEWORK || FB_MXC_SYNC_PANEL
 	depends on FB_MXC_MIPI_DSI_NORTHWEST
 
+config FB_MXC_ORISE_OTM1287A
+	tristate "Orise Tech OTM1287A display driver"
+	depends on FB_MXC_DISP_FRAMEWORK || FB_MXC_SYNC_PANEL
+	depends on FB_MXC_MIPI_DSI || FB_MXC_MIPI_DSI_NORTHWEST
+
 config FB_MXC_LDB
 	tristate "MXC LDB"
 	depends on FB_MXC_SYNC_PANEL
diff --git a/drivers/video/fbdev/mxc/Makefile b/drivers/video/fbdev/mxc/Makefile
index 5b619152673f..8b09a127c570 100644
--- a/drivers/video/fbdev/mxc/Makefile
+++ b/drivers/video/fbdev/mxc/Makefile
@@ -6,6 +6,7 @@ obj-$(CONFIG_FB_MXC_TRULY_PANEL_TFT3P5079E)     += mxcfb_otm8018b_wvga.o
 obj-$(CONFIG_FB_MXC_TRULY_PANEL_TFT3P5581E)	+= mxcfb_hx8363_wvga.o
 obj-$(CONFIG_FB_MXC_RK_PANEL_RK055AHD042)	+= mxcfb_rm68200_wxga.o
 obj-$(CONFIG_FB_MXC_RK_PANEL_RK055IQH042)	+= mxcfb_rm68191_qhd.o
+obj-$(CONFIG_FB_MXC_ORISE_OTM1287A)		+= mxcfb_otm1287a.o
 obj-$(CONFIG_FB_MXC_LDB) += ldb.o
 obj-$(CONFIG_FB_MXC_HDMI)			+= mxc_hdmi.o
 obj-$(CONFIG_FB_MXC_EDID)			+= mxc_edid.o
diff --git a/drivers/video/fbdev/mxc/mipi_dsi.h b/drivers/video/fbdev/mxc/mipi_dsi.h
index ae9b0428ca1e..5a368a2ea329 100644
--- a/drivers/video/fbdev/mxc/mipi_dsi.h
+++ b/drivers/video/fbdev/mxc/mipi_dsi.h
@@ -143,6 +143,11 @@ void mipid_rm68191_get_lcd_videomode(struct fb_videomode **mode, int *size,
                                      struct mipi_lcd_config **data);
 int mipid_rm68191_lcd_setup(struct mipi_dsi_info *mipi_dsi);
 #endif
+#ifdef CONFIG_FB_MXC_ORISE_OTM1287A
+void mipid_otm1287a_get_lcd_videomode(struct fb_videomode **mode, int *size,
+		struct mipi_lcd_config **data);
+int mipid_otm1287a_lcd_setup(struct mipi_dsi_info *mipi_dsi);
+#endif
 
 #ifndef CONFIG_FB_MXC_TRULY_WVGA_SYNC_PANEL
 #error "Please configure MIPI LCD panel, we cannot find one!"
diff --git a/drivers/video/fbdev/mxc/mipi_dsi_northwest.c b/drivers/video/fbdev/mxc/mipi_dsi_northwest.c
index 9df6c9cdb191..2e791b3d500a 100644
--- a/drivers/video/fbdev/mxc/mipi_dsi_northwest.c
+++ b/drivers/video/fbdev/mxc/mipi_dsi_northwest.c
@@ -85,6 +85,11 @@ static struct mipi_dsi_match_lcd mipi_dsi_lcd_db[] = {
 	{
 	 "ROCKTECH-QHD-RK055IQH042",
 	 {mipid_rm68191_get_lcd_videomode, mipid_rm68191_lcd_setup}
+#endif
+#ifdef CONFIG_FB_MXC_ORISE_OTM1287A
+	{
+	 "ORISE-VGA",
+	 {mipid_otm1287a_get_lcd_videomode, mipid_otm1287a_lcd_setup}
 	},
 #endif
 	{
diff --git a/drivers/video/fbdev/mxc/mxcfb_otm1287a.c b/drivers/video/fbdev/mxc/mxcfb_otm1287a.c
new file mode 100644
index 000000000000..67f882fe535f
--- /dev/null
+++ b/drivers/video/fbdev/mxc/mxcfb_otm1287a.c
@@ -0,0 +1,236 @@
+/*
+ * Copyright (C) 2016 FLIR Systems.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
+ */
+
+#include <linux/types.h>
+#include <linux/init.h>
+#include <linux/delay.h>
+#include <linux/platform_device.h>
+#include <linux/err.h>
+#include <linux/clk.h>
+#include <linux/console.h>
+#include <linux/io.h>
+#include <linux/bitops.h>
+#include <linux/spinlock.h>
+#include <linux/mipi_dsi.h>
+#include <linux/mxcfb.h>
+#include <linux/of_gpio.h>
+#include <video/mipi_display.h>
+#include "mipi_dsi.h"
+
+#define OTM1287A_MAX_DPHY_CLK					(300)
+#define OTM1287A_ONE_DATA_LANE					(0x1)
+#define OTM1287A_TWO_DATA_LANE					(0x2)
+#define OTM1287A_CMD_SWRESET					(0x1)
+#define OTM1287A_CMD_SLPOUT					(0x11)
+#define OTM1287A_CMD_DISPON					(0x29)
+#define OTM1287A_REG_MADCTL					(0x36)
+
+
+/* to write parameters 1 2 3 4 to reg 0x5566
+	fill in following struct
+	{0x6600,5,{0x55,0x1,0x2,0x3,0x4}
+*/
+
+struct reg_value {
+	u32	address_shift;
+	u32 	buf_size;
+	u8	buf[24];
+};
+
+static struct reg_value lcd_setup[] =
+{
+	{0x0000,4,{0xff,0x12,0x87,0x1}	},						//Enable Access Command 2 and Software EXTC Enable
+	{0x8000,3,{0xff,0x12,0x87}},							//Enable Access Orise Command 2
+//	{0x9000,9,{0xf6,0x12,0x00,0x00,0x00,0xff,0xff,0xff,0x0f}},//Enable Test pattern - BW lines
+//	{0x9000,9,{0xf6,0x15,0xff,0x00,0x00,0x00,0x00,0xff,0x00}},//Enable Test pattern - R/B Cross
+//	{0x9000,9,{0xf6,0x1C,0x00,0x00,0x00,0x00,0x00,0x00,0x00}},//Enable Test pattern - Scales
+	{0x9000,9,{0xf6,0x13,0xff,0x00,0x00,0x00,0x00,0xff,0x0c}},//Enable Test pattern - R/B Checker board
+//	{0x9000,9,{0xf6,0x16,0x00,0xff,0x00,0x00,0x00,0xff,0x00}},//Enable Test pattern - 3 vertical green scales
+//	{0x9000,9,{0xf6,0x19,0x00,0xff,0x00,0xff,0x00,0x00,0x00}},//Enable Test pattern - 3 horizontal green scales
+
+	{0x8000,10,{0xc0, 0x00, 0x64, 0x00, 0x10, 0x10, 0x00, 0x64, 0x10, 0x10}},//RTN setting : line rate or FP / BP setting
+	{0x9000,7,{0xc0, 0x00, 0x5C, 0x00, 0x01, 0x00, 0x04}},	//MCLK_clr shift 1~3 number
+	{0xb300,3,{0xc0, 0x00, 0x55}},							//Interval Scan Frame
+	{0x8000,3,{0xc1, 0x15, 0x11}},							//OSC setting : 60Hz
+	{0xa200,4,{0xc1, 0x3f, 0x00, 0x3f}},					//Monitor VS / HS setting
+	{0xa000,15,{0xc4, 0x05, 0x10, 0x06, 0x02, 0x05, 0x15, 0x10, 0x05, 0x10, 0x07, 0x02, 0x05, 0x15, 0x10}},	   //dcdc setting
+	{0xb000,3,{0xc4, 0x00, 0x00}},							//clamp voltage setting
+	{0x9100,3,{0xc5, 0x96, 0x42}},							//VGH/VGL voltage setting : [49h = +16V/-12V]
+	{0x0000,3,{0xd8, 0xda, 0xda}},							//GVDD/NGVDD : [B6h B6h = +5.2V -5.2V]
+	{0x0000,2,{0xd9,0x73}},									//VCOM voltage setting
+	{0xb300,2,{0xc5,0x90}},									//VDD_18 & LVDSVDD setting
+	{0xbb00,2,{0xc5,0x8a}},									//LVD voltage level setting
+	{0x8200,2,{0xc4,0x0a}},									//chopper
+	{0xc600,2,{0xb0,0x03}},									//debounce
+	{0x9000,5,{0xf5,0x02, 0x11, 0x02, 0x15}	},				//Pump
+	{0x9000,2,{0xc5,0x50}},									//pump : [00h = 1.5x / 50h = 2x / a0h = 3x]
+	{0x9400,2,{0xc5,0x66}},									//Pump freq. setting :
+	{0xb200,3,{0xf5,0x00, 0x00}},							//VGLO1
+	{0xb600,3,{0xf5,0x00, 0x00}},							//VGLO2
+	{0x9400,3,{0xf5,0x00, 0x00}},							//VCL pump disable
+	{0xd200,3,{0xf5,0x06, 0x15}},							//VCL enable
+	{0xb400,2,{0xc5,0xcc}},									//VGLO1/2 Pull low setting:d[7] vglo1 d[6] vglo2
+
+	{0x8000,12,{0xcb,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//panel timing state control for Sleep in
+	{0x9000,15,{0xcb,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//Enmode L-byte of sig1~15 : (pwron_0/pwron_1/pwron_2/pwron_3)
+	{0xa000,15,{0xcb,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//Enmode L-byte of sig16~30 : (pwron_0/pwron_1/pwron_2/pwron_3)
+	{0xb000,15,{0xcb,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//Enmode L-byte of sig17~40 : (pwron_0/pwron_1/pwron_2/pwron_3)
+	{0xc000,15,{0xcb,0x05, 0x05, 0x05, 0x05, 0x05, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//Enmode L-byte of sig1~15 : (pwro4_0/norm/pwrof_1/pwrof_2)
+	{0xd000,15,{0xcb,0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x05, 0x05, 0x05, 0x05, 0x05, 0x05, 0x05, 0x00}},//Enmode H-byte of sig16~30 : (pwro4_0/norm/pwrof_1/pwrof_2)
+	{0xe000,15,{0xcb,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x05}},//Enmode H-byte of sig17~40 : (pwro4_0/norm/pwrof_1/pwrof_2)
+	{0xf000,12,{0xcb,0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF}},//panel timing state control for LVD
+
+	{0x8000,15,{0xcc,0x03, 0x01, 0x2D, 0x2E, 0x0B, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//panel pad mapping with u2d mode
+	{0x9000,15,{0xcc,0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0D, 0x04, 0x02, 0x2D, 0x2E, 0x0C, 0x0A, 0x00}},//panel pad mapping with u2d mode
+	{0xA000,15,{0xcc,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x0E}},//panel pad mapping with u2d mode
+	{0xB000,15,{0xcc,0x02, 0x04, 0x2E, 0x2D, 0x0E, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//panel pad mapping with u2d mode
+	{0xC000,15,{0xcc,0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0x0C, 0x01, 0x03, 0x2E, 0x2D, 0x0D, 0x0F, 0x00}},//panel pad mapping with u2d mode
+	{0xD000,15,{0xcc,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x0B}},//panel pad mapping with u2d mode
+
+	{0x8000,13,{0xce,0x8B, 0x03, 0x10, 0x8A, 0x03, 0x10, 0x89, 0x03, 0x10, 0x88, 0x03, 0x10}},//panel timing: GOA VST Setting
+	{0x9000,13,{0xce,0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//panel timing: GOA VEND Setting
+	{0xA000,15,{0xce,0x38, 0x07, 0x81, 0xDC, 0x8C, 0x16, 0x00, 0x38, 0x06, 0x81, 0xDD, 0x8B, 0x16, 0x00}},//GOA CLKA1,CLKA2 Setting
+	{0xB000,15,{0xce,0x38, 0x05, 0x81, 0xDE, 0x8C, 0x16, 0x00, 0x38, 0x04, 0x81, 0xDF, 0x8B, 0x16, 0x00}},//GOA CLKA3,CLKA4 Setting
+	{0xC000,15,{0xce,0x38, 0x03, 0x81, 0xE0, 0x8C, 0x16, 0x00, 0x38, 0x02, 0x81, 0xE1, 0x8B, 0x16, 0x00}},//GOA CLKB1,CLKB2 Setting
+	{0xD000,15,{0xce,0x38, 0x01, 0x81, 0xE2, 0x8C, 0x16, 0x00, 0x38, 0x00, 0x81, 0xE3, 0x8B, 0x16, 0x00}},//GOA CLKB3,CLKB4 Setting
+
+	{0x8000,15,{0xcf,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//GOA CLKC1,CLKC2 Setting
+	{0x9000,15,{0xce,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//GOA CLKC3,CLKC4 Setting
+	{0xA000,15,{0xcf,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//GOA CLKD1,CLKD2 Setting
+	{0xB000,15,{0xcf,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},//GOA CLKD3,CLKD4 Setting
+	{0xC000,12,{0xcf,0x3D, 0x3D, 0x20, 0x20, 0x00, 0x00, 0x01, 0x80, 0x10, 0x03, 0x03}},//GOA ECLK Setting
+
+	{0xB500, 7,{0xc5,0x3F, 0xFF, 0xFF, 0x3F, 0xFF, 0xFF}},//TCON_GOA_OUT Setting
+	{0x0000,21,{0xe1,0x08, 0x12, 0x18, 0x25, 0x2E, 0x3A, 0x37, 0x5F, 0x51, 0x6B, 0x98, 0x80, 0x91, 0x5F, 0x47, 0x39, 0x37, 0x29, 0x21, 0x1A}},//Gamma Correction Characteristics Setting (2.2 + )
+	{0x0000,21,{0xe2,0x08, 0x12, 0x18, 0x25, 0x2E, 0x3A, 0x37, 0x5F, 0x51, 0x6B, 0x98, 0x80, 0x91, 0x5F, 0x47, 0x39, 0x37, 0x29, 0x21, 0x1A}},//Gamma Correction Characteristics Setting (2.2 - )
+
+	{0x9300, 2,{0xb0,0x8c}},							//cd err sel.
+	{0x8800, 2,{0xc4,0x80}},							//80h:Time out SD pull VSS.
+	{0x9000, 2,{0xb6,0xb6}},							//sleep out re-load
+	{0x9200, 2,{0xb3,0x02}},							//02h:HS auto Disable CMD1
+	{0x8100, 2,{0xc4,0x82}},							//SAP : [82h = 0.75uA]
+	{0xb200, 2,{0xc5,0xc3}},							//VCL sel.
+	{0xc800, 2,{0xb0,0x42}},							//ESD HS.
+	{0x9800, 2,{0xc5,0x50}},							//LVD pump set
+	{0x9100, 2,{0xc1,0x08}},						//Idle Frame rate / 4
+	{0xa400, 3,{0xc5,0x55,0x55}},						//Idle Mode pump freq.
+
+	{0x8000,3,{0xff,0xff,0xff}},						//Disable Access Orise Command 2
+	{0x0000,4,{0xff,0xff,0xff,0xff}	}					//Disable Access Command 2 & Software EXTC Enable
+};
+
+#if 0
+static struct fb_videomode otm_lcd_modedb[] = {
+	{
+	 "ORISE-VGA", 60, 640, 480, 34422,
+	 150, 150,
+	 16, 16,
+	 2, 2,
+	 FB_SYNC_OE_LOW_ACT,
+	 FB_VMODE_NONINTERLACED,
+	 0,
+	},
+};
+#else
+static struct fb_videomode otm_lcd_modedb[] = {
+	{
+	 "ORISE-VGA", 60, 640, 480, 37000,
+	 100, 100,
+	 31, 10,
+	 96,4,
+	 FB_SYNC_OE_LOW_ACT,
+	 FB_VMODE_NONINTERLACED,
+	 0,
+	},
+};
+#endif
+
+static struct mipi_lcd_config lcd_config = {
+	.virtual_ch	= 0x0,
+	.data_lane_num	= OTM1287A_TWO_DATA_LANE,
+	.max_phy_clk	= OTM1287A_MAX_DPHY_CLK,
+	.dpi_fmt	= MIPI_RGB888,
+};
+
+void mipid_otm1287a_get_lcd_videomode(struct fb_videomode **mode, int *size,
+		struct mipi_lcd_config **data)
+{
+	*mode = &otm_lcd_modedb[0];
+	*size = ARRAY_SIZE(otm_lcd_modedb);
+	*data = &lcd_config;
+}
+
+static int otm1287a_write_reg(struct mipi_dsi_info *mipi_dsi, u32 reg, u32 data)
+{
+	int err;
+	int buf = reg | (data <<8);
+
+	err = mipi_dsi->mipi_dsi_pkt_write(mipi_dsi, MIPI_DSI_DCS_SHORT_WRITE_PARAM,
+		&buf, 0);
+	if(err)
+		dev_err(&mipi_dsi->pdev->dev,"otm1287a_write_reg err:%d \n",err);
+	return err;
+}
+
+static int otm1287a_write_cmd(struct mipi_dsi_info *mipi_dsi, u32 cmd)
+{
+	int err = mipi_dsi->mipi_dsi_pkt_write(mipi_dsi, MIPI_DSI_DCS_SHORT_WRITE,
+		&cmd, 0);
+	msleep(1);
+	if(err)
+		dev_err(&mipi_dsi->pdev->dev,"otm1287a_write_cmd err:%d \n",err);
+	return err;
+}
+
+int mipid_otm1287a_lcd_setup(struct mipi_dsi_info *mipi_dsi)
+{
+	int i;
+
+	pr_info("mipid_otm1287a_lcd_setup\n");
+
+	for(i=0;i<ARRAY_SIZE(lcd_setup);i++)
+	{
+		mipi_dsi->mipi_dsi_pkt_write(mipi_dsi, MIPI_DSI_DCS_SHORT_WRITE_PARAM,
+				&lcd_setup[i].address_shift, 0);
+		if(lcd_setup[i].buf_size == 2)
+			mipi_dsi->mipi_dsi_pkt_write(mipi_dsi, MIPI_DSI_DCS_SHORT_WRITE_PARAM,
+					(u32*) lcd_setup[i].buf, 0);
+		else
+			mipi_dsi->mipi_dsi_pkt_write(mipi_dsi, MIPI_DSI_DCS_LONG_WRITE,
+					(u32*) lcd_setup[i].buf, lcd_setup[i].buf_size);
+	}
+
+	otm1287a_write_reg(mipi_dsi,OTM1287A_REG_MADCTL,0x2);
+	msleep(10);
+	otm1287a_write_cmd(mipi_dsi,OTM1287A_CMD_SLPOUT);
+	msleep(120);
+	otm1287a_write_cmd(mipi_dsi,OTM1287A_CMD_DISPON);
+
+	return 0;
+}
+
+int mipid_otm1287a_lcd_power_on(struct mipi_dsi_info *mipi_dsi)
+{
+	return 0;
+}
+
+int mipid_otm1287a_lcd_power_off(struct mipi_dsi_info *mipi_dsi)
+{
+	return 0;
+}
+
-- 
2.17.1

