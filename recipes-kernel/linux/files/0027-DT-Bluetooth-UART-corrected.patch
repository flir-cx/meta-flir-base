From c5f0c2b183dcffc929e2e82fd57ef921520b3f72 Mon Sep 17 00:00:00 2001
From: Peter Fitger <peter.fitger@flir.se>
Date: Fri, 11 Jan 2019 16:17:21 +0100
Subject: [PATCH] DT Bluetooth UART corrected

---
 arch/arm/boot/dts/imx7ulp-bblc.dts | 48 ++++++++++++++++++++++++++++++++++----
 1 file changed, 44 insertions(+), 4 deletions(-)

diff --git a/arch/arm/boot/dts/imx7ulp-bblc.dts b/arch/arm/boot/dts/imx7ulp-bblc.dts
index d9bc016..3e59753 100644
--- a/arch/arm/boot/dts/imx7ulp-bblc.dts
+++ b/arch/arm/boot/dts/imx7ulp-bblc.dts
@@ -11,6 +11,19 @@
 #include "imx7ulp.dtsi"
 #include <dt-bindings/input/input.h>
 
+/* BBLC GPIO expansion port usage
+ * 
+ * GPIO		Schema		Conn. pin	Usage
+ * PTC 12	GPIO_A7_0 	9
+ * PTC 13	GPIO_A7_1 	10		USB OTG id (dummy)
+ * PTC 14	GPIO_A7_2 	11		WL_REG_ON (Laird)
+ * PTC 15	GPIO_A7_3 	12		BT_REG_ON (Laird)
+ * PTC 16	GPIO_A7_4 	13
+ * PTC 17	GPIO_A7_5 	14
+ * PTC 18	GPIO_A7_6 	15		MIPI dummy
+ * PTC 19	GPIO_A7_7 	16		PMIC IRQ
+ */
+
 / {
 	model = "FLIR Low Cost Brassboard";
 	compatible = "flir,imx7ulp-bblc", "fsl,imx7ulp", "Generic DT based system";
@@ -60,6 +73,27 @@
 			regulator-always-on;
 		};
 	
+		reg_wl: regulator-wl {
+			compatible = "regulator-fixed";
+			regulator-name = "wl";
+			gpio = <&gpio_ptc 14 GPIO_ACTIVE_HIGH>;
+			startup-delay-us = <100>;
+			enable-active-high;
+			regulator-min-microvolt = <3300000>;
+			regulator-max-microvolt = <3300000>;
+			regulator-always-on;
+		};
+	
+		reg_bt: regulator-bt {
+			compatible = "regulator-fixed";
+			regulator-name = "bt";
+			gpio = <&gpio_ptc 15 GPIO_ACTIVE_HIGH>;
+			startup-delay-us = <100>;
+			enable-active-high;
+			regulator-min-microvolt = <3300000>;
+			regulator-max-microvolt = <3300000>;
+			regulator-always-on;
+		};
 	};
 	
 	extcon_usb1: extcon_usb1 {
@@ -129,6 +163,8 @@
 		pinctrl_hog_1: hoggrp-1 {
 			fsl,pins = <
 				IMX7ULP_PAD_PTC1__PTC1	0x3	 //SHUTTER_OUT
+				IMX7ULP_PAD_PTC14__PTC14	0x3	// WL_EN
+				IMX7ULP_PAD_PTC15__PTC15	0x3	// BT_EN
 			>;
 		};
 
@@ -407,6 +443,9 @@
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpuart6>;
 	pinctrl-1 = <&pinctrl_lpuart6>;
+	/* Default 48 MHz FIRC clk does not run at 48 MHz, use 24 MHz SOSC */
+	assigned-clock-parents = <&clks IMX7ULP_CLK_SOSC_BUS_CLK>;
+	assigned-clock-rates = <24000000>;
 	status = "okay";
 };
 
@@ -444,8 +483,8 @@
 /* emmc */
 &usdhc0 {
 	pinctrl-names = "default", "sleep";
-	pinctrl-0 = <&pinctrl_usdhc1>;
-	pinctrl-1 = <&pinctrl_usdhc1>;
+	pinctrl-0 = <&pinctrl_usdhc0>;
+	pinctrl-1 = <&pinctrl_usdhc0>;
 	bus-width = <8>;
 	no-1-8-v;
 	resets = <&emmc_reset>;
@@ -458,11 +497,12 @@
 /* wifi */
 &usdhc1 {
 	pinctrl-names = "default", "sleep";
-	pinctrl-0 = <&pinctrl_usdhc0>;
-	pinctrl-1 = <&pinctrl_usdhc0>;
+	pinctrl-0 = <&pinctrl_usdhc1>;
+	pinctrl-1 = <&pinctrl_usdhc1>;
 	no-1-8-v;
 	non-removable;
 	status = "okay";
+	wifi-host;
 };
 
 &viu {
-- 
1.9.1

