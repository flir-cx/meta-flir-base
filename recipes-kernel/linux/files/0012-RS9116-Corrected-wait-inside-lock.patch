From 0c399b6984b6ae10ba6d6da69353db2e1a9d0e1f Mon Sep 17 00:00:00 2001
From: Peter Fitger <peter.fitger@flir.se>
Date: Tue, 5 Jun 2018 11:08:04 +0200
Subject: [PATCH 2/2] RS9116: Corrected wait inside lock

---
 drivers/net/wireless/rsi/rsi_91x_mac80211.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/wireless/rsi/rsi_91x_mac80211.c b/drivers/net/wireless/rsi/rsi_91x_mac80211.c
index 68d5f7a..3591fa2 100644
--- a/drivers/net/wireless/rsi/rsi_91x_mac80211.c
+++ b/drivers/net/wireless/rsi/rsi_91x_mac80211.c
@@ -1079,7 +1079,7 @@ static int rsi_mac80211_config(struct ieee80211_hw *hw,
 	    (vif->type == NL80211_IFTYPE_STATION)) {
 		unsigned long flags;
 
-		spin_lock_irqsave(&adapter->ps_lock, flags);
+//		spin_lock_irqsave(&adapter->ps_lock, flags);
 		if (conf->flags & IEEE80211_CONF_PS) {
 			rsi_enable_ps(adapter);
 			rsi_reset_event(&common->mgmt_cfm_event);
@@ -1092,7 +1092,7 @@ static int rsi_mac80211_config(struct ieee80211_hw *hw,
 			rsi_wait_event(&common->mgmt_cfm_event,
 				       msecs_to_jiffies(1000));
 		}
-		spin_unlock_irqrestore(&adapter->ps_lock, flags);
+//		spin_unlock_irqrestore(&adapter->ps_lock, flags);
 	}
 
 	/* RTS threshold */
-- 
1.9.1

